
# 14 ジェネリクス

## 14.1 ジェネリクスの概要

### ジェネリクスとは

* ジェネリクスとは型をパラメータとしてプログラムを記述するための機能
* ジェネリクスの機能を使って定義された関数をジェネリクス関数、総称関数、あるいは汎用関数と呼ぶ
* Swiftは標準ライブラリとして多くの関数や型を用意しているが、これらのインターフェースはジェネリクスの機能を多様した宣言の集合体となっている

### ジェネリクスの関数の例

* これまで何度か使ったswap関数はSwiftの標準ライブラリで提供されていて次のように宣言されたジェネリクス関数
```
func swap<T>(inout a: T, inout _ b: T)
```

* <T>と記述されているのが型パラーメータ
* 関数swapは、任意の型Tについて、T型のinout引数を2つとり、値を返さない
* 実際にプログラム内に記述された時に与えられた具体的な値の型をTに当てはめて推論し、矛盾がなければコンパイルできる
* この例では2つの引数の型は同じでなければならない

* 型パラメータに成約のある別の例
```
func max<T: Comparable>(x: T, _ y: T, _ z:T, _ rest: T...) -> T
func max<T: Comparable>(x: T, _ y: T) -> T
```

* 型パラメータのTの後ろにComparableというプロトコル名が書かれているのは、プロトコルComparableに適合していなければならないという成約
* 関数maxは、型T自体が持つ比較の機能を使って引数の中から最大値を取り出して返す

* 2種類以上のパラメータを使う場合は、<T, U>のようにカンマで区切って記述する
* 暗黙のルールとしてTと書けば型パラメータであるという識別子となる

## 14.2 ジェネリクス関数の定義

* ジェネリクスに置き換えたmySwap関数
```
// func mySwap(inout a:Int, inout _ b:Int) {
//     let t = a; a = b; b = t
// } ... Int型に対してのみ有効なmySwap関数

func mySwap<T>(inout a:T, inout _ b:T) { // ジェネリクス関数
    let t = a; a = b; b = t
}
```

* mySwapが文字列やタプルに対しても動作することが確認できる
```
var a = "Aria", b = "Jeanne"
mySwap(&a, &b)
print("a=\(a), b=\(b)") // a=Jeanne, b=Aria と表示
var s = (1, 2), t = (100, 50)
mySwap(&s, &t)
print("s=\(s), t=\(t)") // s=(100, 50), t=(1, 2)
```

* さらにタプルは次のうように実行することもできる
```
var v = ((2, 3), 9 (88, 108))
mySwap(&v.0, &v.2)
print(v) // ((88, 108), 9, (2, 3))
```

* 2つの辞書型データの内容を足し合わせて新しい辞書を作成するために「+」演算子にオーバーロード定義を行う
* 辞書型のキーと値の型は自由で構わないが２つの辞書は同じ型でなければならない

```
func +<Key, Value>(lhs:[Key:Value], rhs:[Key:Value]) -> [Key:Value] {
    var dic = lhs
    for (k, v) in rhs { dic[k] = v}
    return dic
}
```

* 実行例は次のようになる
```
let p = ["レベル":60, "特技":10]
let q = ["番号":1]
let t = p + q
print(t) // ["番号": 1, "レベル": 60, "特技": 10]
```

