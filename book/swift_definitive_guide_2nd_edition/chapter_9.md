# 9.1 参照型とARC

## ARCによるメモリ管理

* Swiftのメモリ管理はインスタンスが変数から参照されたり、されなくなったりすタイミングでリファレンスカウントの値を増減させることで行う
* このメモリ管理方式をARC（Automatic Reference Counting）と呼ぶ
* Objective-Cでは従来、プログラムがリファレンスカウンタの操作を行う方式を利用してきたが、これを自動化したのがARC
* ガーベージコレクションとは異なり、インスタンスが不要になるポイントが実行ドード上でわかっている
* このため処理は高速でメモリの解放に伴う負荷の集中も起きなくなる

```
func temp(entry:[String:Person]) { // 辞書型データを引数とする
    var list = [[String:Person]]()
    list.append(entry)
    print("\(list.count)個のエントリ)
}

temp( ["Natsuki: Person(name:"夏希, age:18] )
```

```
１個のエントリ
夏希: deinit
```

* temp関数が終了する変数listが使われなくなるので、格納されたデータも解放される
* 実行するとtemp関数の実行終了とともにPersonのインスタンスが解放される


## 値型データの共有とコピー

* 値型のデータについて
* C言語の場合配列を関数で処理する場合は、引数として配列の先頭のポインタを渡して無駄なコピーを防ぐ
* SwiftではCopy-On-Writeの方式で配列などの値型のデータを受渡している
* 最初に配列のポインタだけ私、データに変更がないかぎりは１つのデータを共有して参照し、元のデータ側、あるいは渡した先で書き込みが発生した時点でデータの複製を作成する
* 「書き換え時にコピーする」、コピーオンライト (Copy-On-Write) の基本的な形態

* List9-2では、変数に書き込むか書き込まないかで実行時間を比較したところ、書き込みがあるほうが明らかに実行速度に差がある事が分かる例
* 

